<!doctype html>
<html lang="zh-Hant">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>智慧廣告管理後台 / 你的專屬折扣</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/manager.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Header Section -->
    <header>
        <h1>智慧廣告管理後台 / 你的專屬折扣</h1>
        <nav>
            <ul id="nav-links">
                <li class="event"><a href="#" title="促銷活動">促銷活動</a></li>
                <li class="shop"><a href="#" title="店舖管理">店舖管理</a></li>
                <li class="product"><a href="#" title="商品管理">商品管理</a></li>
                <li class="payment"><a href="#" title="金流管理">金流管理</a></li>
                <li class="customer active"><a href="#" title="顧客資料">顧客資料</a></li>
            </ul>
        </nav>
    </header>

    <!-- Main Content -->
    <div class="manager-shell">
        <section class="customer-profile">
            <!-- 顧客資料 -->
            <article id="customer-information">
                <h2>顧客資料</h2>
                <figure class="customer-photo">
                    <img src="{{ context.hero_image_url if context and context.hero_image_url else 'images/face.jpg' }}" alt="顧客影像" loading="lazy">
                </figure>
                <section class="customer-infolist">
                    <ul class="customer-basic-info">
                        <li class="customer-name">{{ context.member.profile_label if context and context.member else '未知顧客' }}</li>
                        <li class="customer-level general">一般會員</li>
                        <li>Face ID：{{ context.member.face_id if context and context.member else '無資料' }}</li>
                        <li>會員編號：{{ context.member.mall_member_id if context and context.member else '無資料' }}</li>
                        <li>會員狀態：{{ context.member.member_status if context and context.member else '無資料' }}</li>
                        <li>入會日期：{{ context.member.joined_at if context and context.member else '無資料' }}</li>
                        <li>點數餘額：{{ context.member.points_balance if context and context.member else '無資料' }}</li>
                    </ul>
                    <ul class="customer-contact-info">
                        <li>性別：{{ context.member.gender if context and context.member else '無資料' }}</li>
                        <li>出生年月：{{ context.member.dob if context and context.member else '無資料' }}</li>
                        <li>聯絡電話：{{ context.member.phone if context and context.member else '無資料' }}</li>
                        <li>電子郵件：{{ context.member.email if context and context.member else '無資料' }}</li>
                        <li>郵遞地址：{{ context.member.address if context and context.member else '無資料' }}</li>
                        <li>職業 / 產業別：{{ context.member.occupation if context and context.member else '無資料' }}</li>
                    </ul>
                </section>
            </article>
        </section>

        <section class="dashboard">
            <!-- 顧客相關資訊 -->
            <section class="hero-card">
                <div class="hero-info">
                    {% if context %}
                        <div class="hero-meta">
                            <span class="tag scenario">情境：{{ context.scenario_key }}</span>
                            <span class="tag window">分析區間：{{ context.prediction.window_label }}</span>
                        </div>
                        <h2>{{ context.member.mall_member_id if context.member else '未知顧客' }}</h2>
                    {% else %}
                        <div class="hero-empty">請先選擇顧客，即可載入預測資訊</div>
                    {% endif %}
                </div>
            </section>

            <!-- 潛在熱銷清單 -->
            <section class="insights-card">
                <header>
                    <div>
                        <h3>本月潛在熱銷清單</h3>
                        <p>依據上一個月的消費紀錄推估尚未購買的商品，並計算購買機率</p>
                    </div>
                    {% if context %}
                        <span class="window-label">分析窗口：{{ context.prediction.window_label }}</span>
                    {% endif %}
                </header>
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>商品編號</th>
                                <th>商品名稱</th>
                                <th>商品類別</th>
                                <th>商品價格</th>
                                <th>商品查閱率</th>
                                <th>預估購買機率</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% if context and context.prediction.items %}
                                {% for item in context.prediction.items %}
                                    <tr>
                                        <td>{{ item.product_code }}</td>
                                        <td>{{ item.product_name }}</td>
                                        <td>{{ item.category_label }}</td>
                                        <td>NT$ {{ '%.0f'|format(item.price) }}</td>
                                        <td>{{ '%.1f'|format(item.view_rate_percent) }}%</td>
                                        <td>{{ '%.1f'|format(item.probability_percent) }}%</td>
                                    </tr>
                                {% endfor %}
                            {% else %}
                                <tr>
                                    <td colspan="6" class="empty">尚無可用預測資料</td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- 顧客標籤 -->
            <section id="customer-tags">
                <h2>顧客標籤</h2>
                <ul class="customer-taglist">
                    <li>#甜點收藏家</li>
                    <li>#健身族群</li>
                    <li>#保健食品</li>
                    <li>#蛋白粉</li>
                    <li>#水果</li>
                    <li>#美妝愛好</li>
                </ul>
            </section>
        </section>
    </div>
</body>
</html>
