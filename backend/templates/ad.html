<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <title>{{ page_title|default("智慧推播廣告") }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- 每 5 秒刷新；可用 refresh_sec 覆蓋 -->
  <meta http-equiv="refresh" content="{{ refresh_sec|default(5) }}">

  {# v2 才載入新版樣式 #}
  {% if request.args.get('v2') %}
    <link rel="preload" as="image" href="{{ hero_image_url|default('/images/ads/000.jpg') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/ads.css') }}">
  {% endif %}

  <style>
    /* 簡易 fallback（當未啟用 v2 時顯示）；不干擾你其他全站樣式 */
    :root{--fg:#111;--bg:#fff}
    html,body{margin:0;background:var(--bg);color:var(--fg);
      font:16px/1.5 system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans TC","PingFang TC","Microsoft JhengHei",sans-serif}
    .legacy-wrap{max-width:1080px;margin:0 auto;padding:20px}
    .legacy-hero{display:flex;gap:20px;align-items:flex-start;flex-wrap:wrap}
    .legacy-hero img{max-width:56vw;max-height:70vh;height:auto;border-radius:12px}
    .legacy-copy h1{margin:.25rem 0 0 0;font-size:1.8rem}
    .legacy-copy p{margin:.25rem 0 .75rem}
    .legacy-bullets{margin:0 0 .75rem 1rem}
    .legacy-cta a{display:inline-block;padding:.6rem .9rem;border-radius:10px;background:#0ea5e9;color:#fff;text-decoration:none;font-weight:700}
    .legacy-note{margin-top:.75rem;color:#666;font-size:.9rem}
  </style>
</head>
<body>

{% if request.args.get('v2') %}
  {# 啟用新版區塊（partial + debug 開關） #}
  {% set debug = (request.args.get('debug') == '1') %}
  {% include "partials/ad_hero.html" %}

{% else %}
  {# 未啟用 v2：顯示簡易舊版視覺 fallback（安全預設，不需相依原版片段） #}
  <div id="legacy-ad-root" class="legacy-wrap">
    <div class="legacy-hero">
      <img src="{{ hero_image_url|default('/images/ads/000.jpg') }}" alt="ad-hero">
      <div class="legacy-copy">
        <h1>{{ copy.title|default("智慧推播廣告") }}</h1>
        <p>{{ copy.subtitle|default("依據歷史偏好或現場狀態，為顧客顯示更 relevant 的內容") }}</p>
        {% set bullets = copy.bullets if copy and copy.bullets is defined and copy.bullets else ["入會好禮","生日禮金","點數回饋"] %}
        <ul class="legacy-bullets">
          {% for b in bullets %}<li>{{ b }}</li>{% endfor %}
        </ul>
        {% if cta and cta.type == "join" %}
          <div class="legacy-cta"><a href="{{ cta.href|default('#') }}">{{ cta.label|default("立即加入會員") }}</a></div>
        {% elif cta and cta.type == "shop" %}
          <div class="legacy-cta"><a href="{{ cta.href|default('#') }}">{{ cta.label|default("前往選購") }}</a></div>
        {% endif %}
        <div class="legacy-note">
          <small>提示：在網址加上 <code>?v2=1</code> 可切換至新版樣式；
          <code>?v2=1&debug=1</code> 顯示偵錯資訊。</small>
        </div>
      </div>
    </div>
  </div>
{% endif %}

</body>
</html>
