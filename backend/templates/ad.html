<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="utf-8" />
    <title>智慧零售廣告看板</title>
    <meta http-equiv="refresh" content="5" />
    <style>
      body {
        margin: 0;
        font-family: "Noto Sans TC", "PingFang TC", sans-serif;
        background: radial-gradient(circle at top, #fef3c7, #f8fafc);
        color: #111827;
      }
      .banner {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        text-align: center;
        padding: 3rem 2rem;
      }
      .hero {
        width: min(72rem, 90vw);
        margin-bottom: 2.5rem;
        border-radius: 2rem;
        overflow: hidden;
        box-shadow: 0 25px 50px rgba(15, 23, 42, 0.18);
      }
      .hero img {
        width: 100%;
        height: auto;
        display: block;
      }
      h1 {
        font-size: 3rem;
        margin-bottom: 0.75rem;
        color: #1d4ed8;
      }
      .subheading {
        font-size: 1.5rem;
        margin-bottom: 2rem;
        color: #334155;
        white-space: pre-line;
      }
      .member-code {
        font-size: 1.1rem;
        margin: 0.5rem 0 1.25rem;
        color: #0f172a;
      }
      .highlight {
        background: #ef4444;
        color: white;
        padding: 1.25rem 2rem;
        border-radius: 1.5rem;
        font-size: 1.75rem;
        font-weight: 600;
        box-shadow: 0 10px 30px rgba(239, 68, 68, 0.35);
        max-width: 60rem;
        white-space: pre-line;
      }
      .insight-card {
        margin-top: 2rem;
        background: rgba(255, 255, 255, 0.85);
        border-radius: 1.25rem;
        padding: 1.5rem 2rem;
        box-shadow: 0 12px 28px rgba(15, 23, 42, 0.12);
        max-width: 56rem;
        color: #1f2937;
      }
      .insight-card .badge {
        display: inline-block;
        padding: 0.35rem 0.9rem;
        border-radius: 999px;
        background: #1d4ed8;
        color: white;
        font-size: 0.9rem;
        margin-bottom: 0.75rem;
        letter-spacing: 0.08em;
      }
      .insight-card p {
        margin: 0.25rem 0;
        line-height: 1.6;
        font-size: 1.05rem;
      }
      .history {
        margin-top: 3rem;
        max-width: 70rem;
        width: 100%;
      }
      .history h2 {
        margin-bottom: 1rem;
        font-size: 1.75rem;
        color: #0f172a;
      }
      .history ul {
        list-style: none;
        padding: 0;
        margin: 0;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(16rem, 1fr));
        gap: 1rem;
      }
      .history li {
        background: white;
        border-radius: 1rem;
        padding: 1.25rem;
        box-shadow: 0 10px 25px rgba(15, 23, 42, 0.08);
      }
      .history .item {
        display: block;
        font-size: 1.3rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
      }
      .history .date,
      .history .meta {
        display: block;
        color: #475569;
      }
      .history-empty {
        margin-top: 2rem;
        font-size: 1.25rem;
        color: #1e293b;
      }
    </style>
  </head>
  <body>
    <div class="banner">
      {% include "partials/ad_hero.html" %}
      <h1>{{ context.headline }}</h1>
      <div class="member-code">
        {% if context.member_code %}
        商場會員代號：{{ context.member_code }}
        {% else %}
        尚未綁定商場會員代號，歡迎至服務台完成綁定
        {% endif %}
      </div>
      <div class="subheading">{{ context.subheading }}</div>
      <div class="highlight">{{ context.highlight }}</div>
      <div class="insight-card">
        {% set scenario = context.insights.scenario %}
        {% if scenario == 'brand_new' %}
          <span class="badge">新客偵測</span>
          <p>第一次來店，尚未累積消費紀錄，立即推播加入會員與公版歡迎廣告。</p>
          <p>完成註冊即可領取開卡禮，並於現場啟用專屬折扣。</p>
        {% elif scenario == 'repeat_purchase' %}
          <span class="badge">回購洞察</span>
          <p>近期 {{ context.insights.repeat_count }} 次都選擇「{{ context.insights.recommended_item }}」，系統自動生成此商品的個人化推播。</p>
          <p>建議同步展示加價購組合或升級方案，提高客單價。</p>
        {% else %}
          <span class="badge">老會員預測</span>
          <p>根據歷史消費，AI 預估再次購買「{{ context.insights.recommended_item }}」的機率約 {{ context.insights.probability_percent }}%。</p>
          <p>推播會員專屬優惠，並提醒可於收銀台加碼點數。</p>
        {% endif %}
      </div>
      {% if context.purchases %}
      <div class="history">
        <h2>歷史消費紀錄</h2>
        <ul>
          {% for purchase in context.purchases %}
          <li>
            <span class="item">{{ purchase.item }}</span>
            <span class="date">{{ purchase.purchased_at }}</span>
            {% set qty = '{:g}'.format(purchase.quantity) %}
            <span class="meta">
              單價：${{ '%.0f'|format(purchase.unit_price) }}｜數量：{{ qty }}｜總價：${{ '%.0f'|format(purchase.total_price) }}
            </span>
          </li>
          {% endfor %}
        </ul>
      </div>
      {% else %}
      <div class="history-empty">尚無歷史紀錄，立即開啟您的專屬優惠！</div>
      {% endif %}
    </div>
  </body>
</html>
