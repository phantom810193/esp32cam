<!-- backend/templates/partials/ad_hero.html -->
{% set hero_url = hero_image_url|default(url_for('static', filename='images/ads/ME0000.jpg')) %}
{% set ad_context = context if context is defined and context else None %}
{% set copy_source = copy if copy is defined and copy else None %}
{% set cta_source = cta if cta is defined and cta else None %}
{% set scenario_value = scenario_key|default('brand_new') %}

{% set title = copy_source.title if copy_source and copy_source.title is defined else (ad_context.headline if ad_context and ad_context.headline is defined else "歡迎光臨！加入會員賺好禮") %}
{% set subtitle = copy_source.subtitle if copy_source and copy_source.subtitle is defined else (ad_context.subheading if ad_context and ad_context.subheading is defined else "新朋友限定，立即入會享專屬優惠") %}
{% set highlight_text = ad_context.highlight if ad_context and ad_context.highlight is defined else (copy_source.highlight if copy_source and copy_source.highlight is defined else None) %}
{% set bullet_source = copy_source.bullets if copy_source and copy_source.bullets is defined and copy_source.bullets else None %}
{% if not bullet_source and highlight_text %}
  {% set bullet_source = [highlight_text] %}
{% endif %}
{% set bullets = bullet_source if bullet_source else ["入會禮", "生日禮", "點數回饋"] %}
{% set callout = highlight_text if highlight_text and bullets != [highlight_text] else None %}

{% set inferred_cta_type = cta_source.type if cta_source and cta_source.type is defined else ("join" if scenario_value in ["brand_new", "unregistered:fitness", "unregistered:homemaker"] else "none") %}
{% set cta_label = cta_source.label if cta_source and cta_source.label is defined else ("立即加入會員" if inferred_cta_type == "join" else "前往選購") %}
{% set cta_href = cta_source.href if cta_source and cta_source.href is defined else "#" %}

<section class="ad-hero">
  {% if debug|default(false) %}
  <div class="debug-bar">
    <strong>DEBUG</strong>
    <span>scenario_key: {{ scenario_value }}</span>
    <span>hero_image_url: {{ hero_url }}</span>
  </div>
  {% endif %}

  <div class="hero">
    <img
      src="{{ hero_url }}"
      alt="ad-hero"
      class="hero-img"
      loading="eager"
      decoding="async"
    />
    <div class="hero-overlay"></div>

    <div class="copy">
      <h1 class="title">{{ title }}</h1>
      <p class="subtitle">{{ subtitle }}</p>

      <ul class="bullets">
        {% for b in bullets %}<li>• {{ b }}</li>{% endfor %}
      </ul>

      {% if callout %}
        <p class="callout">{{ callout }}</p>
      {% endif %}

      {% if inferred_cta_type == "join" %}
        <a class="btn btn-primary" href="{{ cta_href }}">{{ cta_label }}</a>
      {% elif inferred_cta_type == "shop" %}
        <a class="btn" href="{{ cta_href }}">{{ cta_label }}</a>
      {% endif %}
    </div>
  </div>
</section>
