<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="utf-8" />
    <title>Azure Person Group 訓練工具</title>
    <style>
      body {
        font-family: "Noto Sans TC", "PingFang TC", sans-serif;
        margin: 0;
        padding: 2rem;
        background: #f3f4f6;
        color: #111827;
      }
      a {
        color: #2563eb;
      }
      h1 {
        margin-top: 0;
        font-size: 2.2rem;
      }
      .card {
        background: #ffffff;
        border-radius: 1rem;
        padding: 2.5rem;
        box-shadow: 0 15px 30px rgba(15, 23, 42, 0.12);
        max-width: 720px;
      }
      .form-group {
        margin-bottom: 1.5rem;
      }
      label {
        display: block;
        font-weight: 600;
        margin-bottom: 0.5rem;
      }
      input[type="text"] {
        width: 100%;
        padding: 0.75rem 1rem;
        border-radius: 0.75rem;
        border: 1px solid #d1d5db;
        font-size: 1rem;
      }
      input[type="file"] {
        padding: 0.5rem 0;
      }
      button {
        background: linear-gradient(135deg, #2563eb, #4f46e5);
        color: #ffffff;
        border: none;
        border-radius: 999px;
        padding: 0.75rem 1.75rem;
        font-size: 1rem;
        cursor: pointer;
      }
      button:hover {
        opacity: 0.95;
      }
      .notice {
        background: #eef2ff;
        border-radius: 0.75rem;
        padding: 1rem 1.25rem;
        margin-bottom: 1.5rem;
      }
      .errors {
        background: #fee2e2;
        border-left: 4px solid #ef4444;
        border-radius: 0.5rem;
        padding: 1rem 1.25rem;
        margin-top: 1.5rem;
        color: #b91c1c;
      }
      .success {
        background: #dcfce7;
        border-left: 4px solid #16a34a;
        border-radius: 0.5rem;
        padding: 1rem 1.25rem;
        margin-top: 1.5rem;
        color: #166534;
      }
      ul {
        padding-left: 1.5rem;
      }
    </style>
  </head>
  <body>
    <div class="card">
      <h1>Person Group 訓練工具</h1>
      <p>
        透過這個頁面可以替指定的會員 ID 上傳多張臉部照片，先行訓練 Azure Face
        Person Group，讓現場設備能更快辨識回訪顧客。
      </p>
      <p><a href="{{ url_for('index') }}">返回首頁說明頁</a></p>

      {% if not context.azure_enabled %}
      <div class="notice">
        {% if context.azure_person_group_error %}
        ⚠️ {{ context.azure_person_group_error }}
        {% elif not context.azure_configured %}
        ⚠️ 目前尚未設定 AZURE_FACE_ENDPOINT / AZURE_FACE_KEY，無法呼叫 Azure Face
        Person Group API。
        {% else %}
        ⚠️ Azure Face Person Group 功能已停用，僅保留臉部偵測與描述。
        {% endif %}
      </div>
      {% endif %}

      <form method="post" enctype="multipart/form-data">
        <div class="form-group">
          <label for="member_id">會員 ID</label>
          <input
            id="member_id"
            type="text"
            name="member_id"
            required
            value="{{ context.member_id }}"
            placeholder="例如：MEM000123"
          />
        </div>
        <div class="form-group">
          <label for="images">臉部照片（可複選，多張將依序加入）</label>
          <input id="images" type="file" name="images" accept="image/*" multiple required />
        </div>
        <button type="submit">上傳並訓練 Person Group</button>
      </form>

      {% if context.results %}
      <div class="success">
        <p>
          已為會員 <strong>{{ context.member_id }}</strong>
          {% if context.azure_person_id %}
          （Azure Person ID：<code>{{ context.azure_person_id }}</code>）
          {% endif %}
          加入 {{ context.faces_registered }} 張臉部影像。
          {% if context.created_member %}同時也建立了新的會員資料紀錄。{% endif %}
        </p>
        <p>以下檔案已成功註冊：</p>
        <ul>
          {% for item in context.results %}
          <li>{{ item }}</li>
          {% endfor %}
        </ul>
      </div>
      {% endif %}

      {% if context.errors %}
      <div class="errors">
        <p>發生以下問題：</p>
        <ul>
          {% for error in context.errors %}
          <li>{{ error }}</li>
          {% endfor %}
        </ul>
      </div>
      {% endif %}
    </div>
  </body>
</html>
